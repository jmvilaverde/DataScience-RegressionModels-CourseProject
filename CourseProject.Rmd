---
title: "Motor Trend magazine  - Data analysis of influence on MPG for Automatic vs. Manual Transmission."
author: "by jmvilaverde"
date: "Thursday, June 18, 2015"
output: pdf_document
---

##Context

You work for Motor Trend, a magazine about the automobile industry. Looking at a data set of a collection of cars, they are interested in exploring the relationship between a set of variables and miles per gallon (MPG) (outcome). They are particularly interested in the following two questions:

“Is an automatic or manual transmission better for MPG”
"Quantify the MPG difference between automatic and manual transmissions"


##Question

Take the mtcars data set and write up an analysis to answer their question using regression models and exploratory data analyses.

Your report must be:

Written as a PDF printout of a compiled (using knitr) R markdown document.
Brief. Roughly the equivalent of 2 pages or less for the main text. Supporting figures in an appendix can be included up to 5 total pages including the 2 for the main report. The appendix can only include figures.
Include a first paragraph executive summary.
Upload your PDF by clicking the Upload button below the text box.

##Peer Grading

The criteria that your classmates will use to evaluate and grade your work are shown below. 
Each criteria is binary: (1 point = criteria met acceptably; 0 points = criteria not met acceptably)
Your Course Project score will be the sum of the points and will count as 40% of your final grade in the course. 

#Evaluation/feedback on the above work

* Did the student interpret the coefficients correctly?
* Did the student do some exploratory data analyses?
* Did the student fit multiple models and detail their strategy for model selection?
* Did the student answer the questions of interest or detail why the question(s) is (are) not answerable?
* Did the student do a residual plot and some diagnostics?
* Did the student quantify the uncertainty in their conclusions and/or perform an inference correctly?
* Was the report brief (about 2 pages long) for the main body of the report and no longer than 5 with supporting appendix of figures?
* Did the report include an executive summary?
* Was the report done in Rmd (knitr)?

##Report brief (about 2 pages)

###Executive summary (First paragraph)

Automatic/Manual transmission is better...


#### Data adquisition

##### 1. Data adquisition and Initial structure analysis

##### 1.1. Variables

```{r dataAdquisition, echo=TRUE}
data(mtcars)
        
#?mtcars

#Show colnames of mtcars
names(mtcars)
```

**mtcars**

Format: _A data frame with 32 observations on 11 variables._

Variable| Units
------- | -----------
**mpg** | **Miles/(US) gallon**
cyl     | Number of cylinders
disp    | Displacement (cu.in.)
hp      | Gross horsepower
drat    | Rear axle ratio
wt      | Weight (lb/1000)
qsec    | 1/4 mile time
vs      | V/S
**am**  | **Transmission (0 = automatic, 1 = manual)**
gear    | Number of forward gears
carb    | Number of carburetors

```{r structureMtcars, echo=TRUE}
#Show structure of mtcars
str(mtcars)
```


##### 2.Initial analysis
Selected variables: 

* Predictor:    X = am,  Transmission with values 0 for automatic, 1 for manual.
* Outcome:      Y = mpg, Miles/(US) gallon

Linear regression model formula:

* Y = ${\beta}_0 + {\beta}_1X$ -> mpg = ${\beta}_0 + {\beta}_1am$

Create initial model:

Calculate $\beta_0$ (Intercept): $\hat{\beta}_0=\bar{Y}+\hat{\beta}_1 \bar{X}$

Calculate $\beta_1$ (Slope): $\hat{\beta}_1= Cor(Y,X)\frac{Sd(Y)}{Sd(X)}$

Fitting the best line:

* $\Sigma_{n}^{i=1}{(Y_i-(\beta_0+\beta_1X_i))}^2$ to minimize the distance.

```{r teoreticalFormula, echo=TRUE}
#Theoretical formula
y <- mtcars$mpg
x <- mtcars$am
beta1 <- cor(y,x)*(sd(y)/sd(x))
beta0 <- mean(y) - beta1 * mean(x)
#R function
model.Initial <- lm(y ~ x)
coeffs <- coef(model.Initial)

#Comparation
rbind(c(beta0, beta1), coeffs)
```

For linear model $Y=\beta_0+\beta_1X$ -> $mpg=\beta_0+\beta_1am$

* Intercept $\beta_0=$ `r beta0`
* Slope $\beta_1=$ `r beta1`

> For this linear regression model, the expected difference in MPG is `r beta1` when the car have manual transmission in comparation to the same car with automatic transmission.
The Intercept `r beta0` is the expected MPG of a automatic transmission car.

```{r plotModelInitial, echo=TRUE}
color <- ifelse(x==0,"red","blue")
plot(x,y,col=color,xlab="x=am",ylab="y=mpg")
legend("top",c("Automatic","Manual"),col=c("red","blue"),pch=1)
abline(model.Initial)
```

_View Figure 1 for plot with regression line._

###Normalizing data????

##### 3.Basic regression model with additive Gaussian errors.

Into point 2 is obtained a linear regression model that fits the data, but doesn't take in consideration the impact of the others variables. We are going to analyze gaussian errors for Initial Model.

Selected variables: 

* **Predictor**:    X = am,  Transmission with values 0 for automatic, 1 for manual.
* **Outcome**:      Y = mpg, Miles/(US) gallon

Probabilistic model for linear regression:

* $Y_i={\beta}_0+{\beta}_1X_i+\epsilon_i$ -> $mpg_i={\beta}_0+{\beta}_1am_i+\epsilon_i$
* $\epsilon_i$ are assumed iid $N(\mu_i,\sigma^2)$. 
* Note, $E[Y_i|X_i=x_i]=\mu_i=\beta_0+\beta_1x_i$ and $Var(Y_i|X_i=x_i)=\sigma^2$.
* $\hat{\beta}_0=\bar{Y}+\hat{\beta}_1 \bar{X}$ and $\hat{\beta}_1= Cor(Y,X)\frac{Sd(Y)}{Sd(X)}$.

Residuals analysis:

* Observed outcome i is $Y_i$ at a predictor value $X_i$.
* Predicted outcome i is $\hat{Y}_i$ at a predictor value $X_i$ is $\hat{Y}_i=\hat{\beta}_0+\hat{\beta}_1X_i$.
* Residual is the difference between observed an predicted: $e_i=Y_i-\hat{Y}$, the vertical distance between the observed data point and the regression line.
* Least squares minimizes $\Sigma_{i=1}^ne_i^2$.
* $e_i$ can be thought of as estimates of the $\epsilon_i$.
```{r residualsModelInitial, echo=TRUE}
#Calculate residuals
e.ModelInitial <- y-(beta0+beta1*x)
e.ModelInitial
#R function for residuals
resid(model.Initial)

#Calculate predicted y (mpg)
yhat <- predict(model.Initial)
#Calculate max difference between residual and observed Y - predicted Y (y hat)
max(abs(e.ModelInitial -(y - yhat)))
```

Plot of residuals:
```{r plotResidual, echo=TRUE}
plot(x, resid(model.Initial))
abline(h=0)
```


Formula to estimate residual variation: 

* ML estimate of $\sigma^2$ is $\frac{1}{n}\Sigma^n_{i=1}e^2_i$
* For $E[\hat\sigma^2]=\sigma^2$ most people use $\frac{1}{n-2}\Sigma^n_{i=1}e^2_i$

```{r residualVariationModelInitial, echo=TRUE}
#Calculate variation
n <- length(y)
var.e.Model.Initial <- sqrt((1/(n-2))*sum((e.ModelInitial^2)))
var.e.Model.Initial
#R function to calculate residual variation
summary(model.Initial)$sigma
```

Model Initial has a residual variation of `r var.e.Model.Initial`.

#### Total variation.

Formula Total variation = Residual variation + Regression Variation:

* $\Sigma^n_{i=1}(Y_i-\bar{Y})^2=\Sigma^n_{i=1}(Y_i-\hat{Y}_i)^2+\Sigma^n_{i=1}(\hat{Y}_i-\bar{Y})^2$

Define the percent of total variation described by the model as:

* $R^2=\frac{\Sigma^n_{i=1}(\hat{Y}_i-\bar{Y})^2}{\Sigma^n_{i=1}(Y_i-\bar{Y})^2}=1-\frac{\Sigma^n_{i=1}(Y_i-\hat{Y}_i)^2}{\Sigma^n_{i=1}(Y_i-\bar{Y})^2}$

Relation between $R^2$ and r (the correlation):

Recall that: $(\hat{Y}_i-\bar{Y})=\hat\beta_1(X_i-\bar{X})$ so that

* $R^2=\frac{\Sigma^n_{i=1}(\hat{Y}_i-\bar{Y})^2}{\Sigma^n_{i=1}(Y_i-\bar{Y})^2}=\hat\beta^2_1\frac{\Sigma^n_{i=1}(X_i-\bar{X})}{\Sigma^n_{i=1}(Y_i-\bar{Y})^2}=Cor(Y,X)^2$


```{r rModelInitial, echo=TRUE}
#Calculate R2
R2.Model.Initial <- sum((yhat - mean(y))^2)/sum((y-mean(y))^2)
R2.Model.Initial
#R function for R2
cor(y,x)^2
```

Inference in regression

Create confidence intervals and perform hypothesis tests.

```{r confIntervalsModelInitial,echo=TRUE}
#Calculation of coefficients
sigma <- var.e.Model.Initial
ssx <- sum((x - mean(x))^2)
seBeta0 <- (1/n + mean(x)^2/ssx) ^ 0.5 * sigma
seBeta1 <- sigma / sqrt(ssx)
tBeta0 <- beta0 / seBeta0
tBeta1 <- beta1 / seBeta1
pBeta0 <- 2 * pt(abs(tBeta0), df=n-2, lower.tail=FALSE)
pBeta1 <- 2 * pt(abs(tBeta1), df=n-2, lower.tail=FALSE)
coefTable <- rbind(c(beta0, seBeta0, tBeta0, pBeta0), c(beta1, seBeta1, tBeta1, pBeta1))
colnames(coefTable) <- c("Estimate","Std.Error", "t value", "P(>|t|)")
rownames(coefTable) <- c("(Intercept)", "x")
coefTable

#R function for calculate coefficients
summary(model.Initial)$coef
```

Getting a confidence interval
```{r confidenceIntervalModelInitial, echo=TRUE}
sumCoef <- summary(model.Initial)$coef
confInterval.Model.Initial <- sumCoef[1,1] + c(-1,1) * qt(0.975, df=model.Initial$df) * sumCoef[1,2]
confInterval.Model.Initial
```

With 95% confidence, we estimate that a conversion from automatic transmission to manual transmission results in a `r confInterval.Model.Initial[1]` to `r confInterval.Model.Initial[2]` increase in MPG for the Initial Model.

##Final Analysis for Model Initial

_This analysis doesn't take in consideration other variables that MUST be evaluated due the influence on relation between MPG and the type of transmission AM. Is required a Multivariable regression model._

### Is an automatic or manual transmission better for MPG?

> The manual transmission is better for MPG.

### Quantify the MPG difference between automatic and manual transmissions.

> With 95% confidence, we estimate that a manual transmission results in a `r confInterval.Model.Initial[1]` to `r confInterval.Model.Initial[2]` increase in MPG comparing to use of automatic transmission for the Model Initial.

> * Predictor:    X = am,  Transmission with values 0 for automatic, 1 for manual.
> * Outcome:      Y = mpg, Miles/(US) gallon

> Linear regression model formula: Y = ${\beta}_0 + {\beta}_1X$ -> mpg = ${\beta}_0 + {\beta}_1am$

### Use of other models

This model lacks of ?precission?. is required to use aditional variables from the original dataset.

For this, is needed the use of multivariable regression analyses.



###“Is an automatic or manual transmission better for MPG”

***

# Muliiable regression models



##Main Body + Apendix only figures (not more than 5)